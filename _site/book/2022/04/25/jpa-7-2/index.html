<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
<meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>


<meta name="description" content="✓︎ 복합키와 식별 관계 매핑
    1) 식별 관계 vs 비식별 관계
    2) 복합키: 비식별 관계 매핑
    3) 복합키: 식별 관계 매핑
    4) 비식별 관계로 구현
    5) 일대일 식별 관계
    6) 식별, 비식별 관계의 장단점
" />
<meta property="og:description" content="✓︎ 복합키와 식별 관계 매핑
    1) 식별 관계 vs 비식별 관계
    2) 복합키: 비식별 관계 매핑
    3) 복합키: 식별 관계 매핑
    4) 비식별 관계로 구현
    5) 일대일 식별 관계
    6) 식별, 비식별 관계의 장단점
" />

<meta name="author" content="Chloe" />


<meta property="og:title" content="자바 ORM 표준 JPA 프로그래밍 - (7) 고급 매핑 - 복합키" />
<meta property="twitter:title" content="자바 ORM 표준 JPA 프로그래밍 - (7) 고급 매핑 - 복합키" />



    <title>자바 ORM 표준 JPA 프로그래밍 - (7) 고급 매핑 - 복합키 – Chloe – 조금씩, 천천히, 꾸준히</title>

    <link rel="stylesheet" type="text/css" href="/style.css"/>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/ress/dist/ress.min.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="/assets/image/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/assets/image/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/assets/image/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="alternate" type="application/rss+xml" title="Chloe - 조금씩, 천천히, 꾸준히" href="/feed.xml"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous" media="print" onload="this.media='all'"/>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.5/plyr.css" media="print" onload="this.media='all'"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" media="print" onload="this.media='all'"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous" media="print" onload="this.media='all'"/>

  </head>

  <body>
    </div>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/assets/image/avatar.png" width="70" height="70" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Chloe</a></h1>
            <p class="site-description">조금씩, 천천히, 꾸준히</p>
          </div>

          <nav class="nav-menu">
            
  <a class="nav-menu-item"<a href="/">Blog</a>

  <a class="nav-menu-item"<a href="/tags">Tag</a>

  <a class="nav-menu-item"<a href="/about">About</a>

  <a class="nav-menu-item"<a href="/search">Search</a>


          </nav>
        </header>
      </div>
    </div>

    <div class="post-container">
      <div id="category" class="category">
        <aside>
          
          
            
              
            
          
            
              
              <a class="category-link " href="/category/Book/">
                <i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbspBook
              </a>
              
            
          
            
              
              <a class="category-link " href="/category/Daily/">
                <i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbspDaily
              </a>
              
            
          
            
              
              <a class="category-link " href="/category/Programming/">
                <i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbspProgramming
              </a>
              
            
          
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </aside>
      </div>
      <div id="main" role="main" class="content">
        <article class="post">
  <div class="post-title">

    <p class="title">자바 ORM 표준 JPA 프로그래밍 - (7) 고급 매핑 - 복합키</p>

    <div class="post-option">
      <!--<div class="post-categories">
        <i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbsp;Tags:&nbsp;
        
        
        <a class="categories-button"<a href="/categories/#Book">Book</a>
        
        
      </div>-->
      <div class="date">
        <i class="fa fa-calendar fa-fw" aria-hidden="true"></i>&nbsp;Date: 2022-04-25
      </div>
    </div>
  </div>

  <div class="entry">
    <p class="notice-list"><a href="#복합키와-식별-관계-매핑">✓︎ 복합키와 식별 관계 매핑</a><br />
    <a href="#1-식별-관계-vs-비식별-관계">1) 식별 관계 vs 비식별 관계</a><br />
    <a href="#2-복합키-비식별-관계-매핑">2) 복합키: 비식별 관계 매핑</a><br />
    <a href="#3-복합키-식별-관계-매핑">3) 복합키: 식별 관계 매핑</a><br />
    <a href="#4-비식별-관계로-구현">4) 비식별 관계로 구현</a><br />
    <a href="#5-일대일-식별-관계">5) 일대일 식별 관계</a><br />
    <a href="#6-식별-비식별-관계의-장단점">6) 식별, 비식별 관계의 장단점</a></p>

<h3 id="복합키와-식별-관계-매핑">복합키와 식별 관계 매핑</h3>
<p><strong>복합키</strong>는 두 개 이상의 컬럼을 조합하여 기본키 역할을 할 수 있게 만든 키를 뜻한다.<br />
예를들어 동물원은 많지만 서울광진구에있는 동물원은 하나인것처럼 2개 이상의 기준이 되었을경우에 식별이 가능한 값들이 있다.</p>

<h4 id="1-식별-관계-vs-비식별-관계">1) 식별 관계 vs 비식별 관계</h4>
<p>데이터베이스 테이블 사이의 관계는 외래키가 기본키에 포함되는지 여부에 따라 식별 관계와 비식별 관계로 구분한다.</p>

<ul>
  <li><strong class="bg-pink outline">식별 관계</strong> : 부모 테이블의 기본 키를 내려받아서 자식 테이블의 <strong>기본키 + 외래키</strong>로 사용하는 관계</li>
  <li><strong class="bg-pink outline">비식별 관계</strong> : 부모 테이블의 기본 키를 받아서 자식 테이블의 <strong>외래키</strong>로만 사용하는 관계
    <ul>
      <li>비식별 관걔는 외래키에 NULL을 허용하는지에 따라 필수적 비식별 관계와 선택적 비식별 관계로 구분한다.  식    <strong class="bg-ly outline">필수적 비식별 관계(Mendatory)</strong> : 외래키에 NULL을 허용하지 않는다. <strong class="underline">연관관계를 필수적으로 맺어야 한다.</strong><br />
<strong class="bg-ly outline">선택적 비식별 관계(Optional)</strong> : 외래키에 NULL을 허용한다. <strong class="underline">연관관계를 맺을지 선택할 수 있다.</strong></li>
    </ul>
  </li>
  <li>최근에는 비식별 관계를 주로 사용하고 꼭 필요한 곳에만 식별 관계를 사용하는 추세다.</li>
  <li class="blank"></li>
</ul>

<h4 id="2-복합키-비식별-관계-매핑">2) 복합키: 비식별 관계 매핑</h4>
<ul>
  <li>
    <p>기본키</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>복합 기본키
    <ul>
      <li>다음과 같이 사용하면 매핑 예외가 발생한다.</li>
      <li>복합키에는 <code class="language-plaintext highlighter-rouge">@GenerateValue</code>를 사용할 수 없다. 복합키를 구성하는 여러 컬럼 중 하나에도 사용할 수 없다.</li>
      <li class="blank half"></li>
    </ul>

    <div class="language-java indent highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>  <span class="c1">// 실행 시점에 매핑 예외 발생</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p class="notice-primary">JPA는 영속성 컨텍스트에 엔티티를 보관할 때 엔티티의 식별자를 키로 사용한다. 그리고 식별자를 구분하기 위해 equals와 hashCode를 사용해서 동등성 비교를 한다. 그런데 식별자 필드가 2개 이상이면 별도의 식별자 클래스를 만들고 그곳에 equals와 hashCode를 구현해야 한다.</p>

    <p><strong class="pre-arrow">JPA는 복합키를 지원하기 위해 <code class="language-plaintext highlighter-rouge">@IdClass</code>와 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code> 2가지 방법을 제공한다.</strong><br />
<code class="language-plaintext highlighter-rouge">@IdClass</code>가 데이터베이스에 맞춘 방법이라면 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code>는 좀 더 객체지향적인 방법이다.</p>

    <details>
  <summary><code>@IdClass</code></summary>
  <div>
        <ul>
          <li>부모 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">ParentId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">nema</span> <span class="o">=</span> <span class="s">"PATRENT_ID1"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>  <span class="c1">// 식별자 클래스의 ParentId.id1 과 연결</span>
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">nema</span> <span class="o">=</span> <span class="s">"PATRENT_ID2"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>  <span class="c1">// 식별자 클래스의 ParentId.id2 와 연결</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>
      	
    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">(</span><span class="nc">String</span> <span class="n">id1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id1</span> <span class="o">=</span> <span class="n">id1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id2</span> <span class="o">=</span> <span class="n">id2</span><span class="o">;</span>
    <span class="o">}</span>
      
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
      
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>            </div>

            <p class="notice-basic no-marker"><strong>식별자 클래스는 다음 조건을 만족해야 한다.</strong><br />
- 식별자 클래스의 속성명과 엔티티 클래스에서 사용하는 식별자의 속성명이 같아야 한다.<br />
- Serializable 인터페이스를 구현해야 한다.<br />
- equals, hashCode를 구현해야 한다.<br />
- 기본 생성자가 있어야 한다.<br />
- 식별자 클래스는 public이어야 한다.</p>

            <ul>
              <li class="blank"></li>
              <li>자식 클래스
                <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
        
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"PARERNT_ID1"</span><span class="o">),</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"PARERNT_ID2"</span><span class="o">),</span>
    <span class="o">})</span>
    <span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>                </div>
              </li>
            </ul>
          </li>
        </ul>
      </div>
  </details>

    <details>
  <summary><code>@EmbeddedId</code></summary>
  <div>
        <ul>
          <li>부모 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">private</span> <span class="nc">ParentId</span> <span class="n">parentId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParentId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID1"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id1</span><span class="o">;</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID2"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">;</span>
      	
    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nf">ParentId</span><span class="o">(</span><span class="nc">String</span> <span class="n">id1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">id2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id1</span> <span class="o">=</span> <span class="n">id1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id2</span> <span class="o">=</span> <span class="n">id2</span><span class="o">;</span>
    <span class="o">}</span>
      
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
      
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>            </div>

            <ul>
              <li><code class="language-plaintext highlighter-rouge">@IdClass</code>와는 다르게 식별자 클래스에 기본키를 직접 매핑한다.</li>
            </ul>

            <p class="notice-basic no-marker"><strong>식별자 클래스는 다음 조건을 만족해야 한다.</strong><br />
- @Embeddable 어노테이션을 붙여주어야 한다.<br />
- Serializable 인터페이스를 구현해야 한다.<br />
- equals, hashCode를 구현해야 한다.<br />
- 기본 생성자가 있어야 한다.<br />
- 식별자 클래스는 public이어야 한다.</p>
          </li>
        </ul>
      </div>
  </details>
  </li>
  <li class="blank"></li>
</ul>

<h5 id="-복합키와-equals-hashcode">▪ 복합키와 equals(), hashCode()</h5>

<p class="indent">복합키는 equals()와 hashCode()를 필수로 구현해야 한다.</p>
<div class="language-java indent highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ParentId</span> <span class="n">id1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">();</span>
<span class="n">id1</span><span class="o">.</span><span class="na">setId1</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">);</span>
<span class="n">id1</span><span class="o">.</span><span class="na">setId2</span><span class="o">(</span><span class="s">"myId2"</span><span class="o">);</span>

<span class="nc">ParentId</span> <span class="n">id2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ParentId</span><span class="o">();</span>
<span class="n">id2</span><span class="o">.</span><span class="na">setId1</span><span class="o">(</span><span class="s">"myId1"</span><span class="o">);</span>
<span class="n">id2</span><span class="o">.</span><span class="na">setId2</span><span class="o">(</span><span class="s">"myId2"</span><span class="o">);</span>
</code></pre></div></div>

<p class="indent"><strong class="pre-arrow">id1.equals(id2) 는 참일까 거짓일까?</strong>  <br />
  equals()를 적절히 오버라이딩했다면 참이겠지만 equals()를 적절히 오버라이딩 하지 않았다면 결과는 거짓이다. equals()는 인스턴스 참조값 비교인 <code class="language-plaintext highlighter-rouge">==</code> 비교(동일성 비교)를 하기 때문이다.</p>

<ul>
  <li class="blank half"></li>
</ul>

<h5 id="︎-idclass-vs-embeddedid">▪︎ @IdClass vs @EmbeddedId</h5>
<ul class="indent">
  <li><code class="language-plaintext highlighter-rouge">@IdClass</code>와 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code>는 각각 장단점이 있으므로 취향에 맞는 것을 사용하면 된다.</li>
  <li><code class="language-plaintext highlighter-rouge">@EmbeddedId</code>가 <code class="language-plaintext highlighter-rouge">@IdClass</code>와 비교해서 더 객체지향적이고 중복도 없어서 좋아보이긴 하지만 특정 상황에 JPQL이 조금 더 길어질 수 있다.</li>
</ul>

<div class="language-java indent highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p.id.id1, p.id.id2 from Parent p"</span><span class="o">);</span>  <span class="c1">// @EmbeddedId</span>
<span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select p.id1, p.id2 from Parent p"</span><span class="o">);</span>  <span class="c1">// @IdClass</span>
</code></pre></div></div>

<ul>
  <li class="blank"></li>
</ul>

<h4 id="3-복합키-식별-관계-매핑">3) 복합키: 식별 관계 매핑</h4>
<p><img src="https://velog.velcdn.com/images%2Fshininghyunho%2Fpost%2Fb7caf0ae-16f5-40c4-896c-c99a67276890%2Fimage.png" alt="" class="center" width="80%" /></p>

<ul>
  <li>식별 관계에서 자식 테이블은 부모 테이블의 기본 키를 포함해서 복합키를 구성해야 하므로 <code class="language-plaintext highlighter-rouge">@IdClass</code>나 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code>를 사용해서 식별자를 매핑해야 한다.</li>
  <li>식별 관계는 기본키와 외래키를 같이 매핑해야 한다.</li>
  <li>
    <p>식별자 매핑인 <code class="language-plaintext highlighter-rouge">@Id</code>와 연관관계 매핑인 <code class="language-plaintext highlighter-rouge">@ManyToOne</code>을 같이 사용하면 된다.</p>

    <details>
  <summary><code>@IdClass</code></summary>
  <div>
        <ul>
          <li>부모 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">ParentId</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>자식 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">ChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@Id</span>                              <span class="c1">// 기본키 매핑</span>
    <span class="nd">@ManyToOne</span>                       <span class="c1">// 외래키 매핑</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>  <span class="c1">// 외래키 매핑</span>
    <span class="kd">public</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
      
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span>
      
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>Child 식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">parent</span><span class="o">;</span>  <span class="c1">// Child.parent 매핑</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">childId</span><span class="o">;</span>  <span class="c1">// Child.childId 매핑</span>
      
    <span class="c1">// equals, hashCode</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>손자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@IdClass</span><span class="o">(</span><span class="nc">GrandChildId</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
    <span class="nd">@Id</span>                                  <span class="c1">// 기본키 매핑</span>
    <span class="nd">@ManyToOne</span>                           <span class="c1">// 외래키 매핑</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>                       <span class="c1">// 외래키 매핑</span>
            <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
            <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">public</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
      
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>GrandChild 식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">child</span><span class="o">;</span>  <span class="c1">// GrandChild.child 매핑</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>  <span class="c1">// GrandChild.id 매핑</span>
      
    <span class="c1">// equals, hashCode</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </div>
  </details>

    <details>
  <summary><code>@EmbeddedId</code></summary>
  <div>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@EmbeddedId</code>로 식별 관계를 구성할 때는 <code class="language-plaintext highlighter-rouge">@MapsId</code>를 사용해야 한다.</li>
          <li><code class="language-plaintext highlighter-rouge">@MapsId</code>는 외래키와 매핑한 연관관계를 기본키에도 매핑하겠다는 뜻이다.</li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">@MapsId</code>의 속성값은 <code class="language-plaintext highlighter-rouge">@EmbeddedId</code>를 사용한 식별자 클래스의 기본키 필드를 지정하면 된다.</p>
          </li>
          <li>부모 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="nd">@Id</span> <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">ParentId</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>자식 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">public</span> <span class="nc">ChildId</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"parentId"</span><span class="o">)</span>  <span class="c1">// ChildId.parentId 매핑</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
      
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>Child 식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">parentId</span><span class="o">;</span>  <span class="c1">// @MapsId("parentId")로 매핑</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="c1">// equals, hashCode</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>손자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">private</span> <span class="nc">GrandChildId</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"childId"</span><span class="o">)</span>  <span class="c1">// GrandChildId.childId 매핑</span>
    <span class="nd">@ManyToOne</span>                    
    <span class="nd">@JoinColumns</span><span class="o">({</span>
            <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">),</span>
            <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="kd">public</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
      
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
          <li>GrandChild 식별자 클래스
            <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChildId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">ChildId</span> <span class="n">childId</span><span class="o">;</span>  <span class="c1">// @MapsId("childId")로 매핑</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
      
    <span class="c1">// equals, hashCode</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>            </div>
          </li>
        </ul>
      </div>
  </details>
  </li>
  <li class="blank"></li>
</ul>

<h4 id="4-비식별-관계로-구현">4) 비식별 관계로 구현</h4>
<p class="indent">식별관계의 복합키 클래스를 만들지 않아도 되므로 매핑도 쉽고 코드도 단순하다.</p>
<div class="language-java indent highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 부모</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
	<span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="c1">// 자식</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span> <span class="o">{</span>
	<span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	
	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PARENT_ID"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Parent</span> <span class="n">parent</span><span class="o">;</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="c1">// 손자</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandChild</span> <span class="o">{</span>
	<span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"GRANDCHILD_ID"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	
	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CHILD_ID"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Child</span> <span class="n">child</span><span class="o">;</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li class="blank"></li>
</ul>

<h4 id="5-일대일-식별-관계">5) 일대일 식별 관계</h4>
<p><img src="https://velog.velcdn.com/images%2Fshininghyunho%2Fpost%2Fe165d591-ef41-4892-8dab-0cce692d95ed%2Fimage.png" alt="" class="center" width="75%" /></p>

<ul>
  <li>일대일 식별 관계는 자식테이블의 기본키 값으로 부모 테이블의 기본키 값만 사용하면 된다.</li>
  <li>식별자가 단순히 컬럼 하나면 <code class="language-plaintext highlighter-rouge">@MapsId</code>를 사용하고 <strong class="underline">속성값은 비워두면 된다.</strong>
    <ul>
      <li>
        <p>이때 <code class="language-plaintext highlighter-rouge">@MapsId</code>는 <code class="language-plaintext highlighter-rouge">@Id</code>를 사용해서 식별자로 지정한 컬럼과 매핑된다.</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// 부모</span>
  <span class="nd">@Entity</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="o">{</span>
  <span class="nd">@Id</span> <span class="nd">@GeneratedValue</span>
  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_ID"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
        
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
        	
      <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">BoardDetail</span> <span class="n">boardDetail</span><span class="o">;</span>
      <span class="o">...</span>
  <span class="o">}</span>
        
  <span class="c1">// 자식</span>
  <span class="nd">@Entity</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardDetail</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">boardId</span><span class="o">;</span>
        
      <span class="nd">@MapsId</span>  <span class="c1">// BoardDetail.boardId 매핑</span>
      <span class="nd">@OneToOne</span>
      <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"BOARD_ID"</span><span class="o">)</span>
      <span class="kd">private</span> <span class="nc">Board</span> <span class="n">board</span><span class="o">;</span>
        	
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
      <span class="o">...</span>
  <span class="o">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li class="blank"></li>
</ul>

<h4 id="6-식별-비식별-관계의-장단점">6) 식별, 비식별 관계의 장단점</h4>

<h5 id="-데이터베이스-설계-관점">✓ 데이터베이스 설계 관점</h5>
<ul>
  <li>데이터베이스 설계 관점에서 식별관계 보다 비식별 관계를 선호한다.
    <ul>
      <li>식별 관계는 부모 테이블의 기본키를 자식 테이블로 전파하면서 자식 테이블의 기본키 컬럼이 점점 늘어난다.</li>
      <li>식별 관계는 2개 이상의 컬럼을 합해서 복합 기본키를 만들어야 하는 경우가 많다.</li>
      <li>반면에 비식별 관계의 기본키는 비즈니스와 전혀 관계없는 대리키를 주로 사용한다.</li>
    </ul>
  </li>
</ul>

<h5 id="-객체-관계-매핑-관점">✓ 객체 관계 매핑 관점</h5>
<ul>
  <li>객체 관계 매핑의 관점에서 비식별 관계를 선호한다.
    <ul>
      <li>일대일 관계를 제외하고 식별 관계는 2개 이상의 컬럼을 묶은 복합 기본키를 사용한다.</li>
      <li>JPA에서 복합키는 별도의 복합키 클래스를 만들어서 사용해야 한다. 컬럼이 하나인 기본키를 매핑하는 것보다 많은 노력이 필요하다.</li>
      <li>비식별 관계의 기본키는 주로 대리키를 사용하는데 JPA는 <code class="language-plaintext highlighter-rouge">@GenerateValue</code>처럼 대리키를 생성하기 위한 편리한 방법을 제공한다.</li>
    </ul>
  </li>
</ul>

<h5 id="-식별-관계의-장점">✓ 식별 관계의 장점</h5>
<ul>
  <li>기본키 인덱스를 활용하기 좋다.</li>
  <li>상위 테이블의 기본키 컬럼을 자식, 손자, 테이블들이 가지고 있으므로 특정 상황에 조인 없이 하위 테이블만으로 검색을 완료할 수 있다.</li>
</ul>

<h5 id="-orm-신규-프로젝트-진행시-추천하는-방법">✓ ORM 신규 프로젝트 진행시 추천하는 방법</h5>
<ul>
  <li>될 수 있으면 비식별 관계를 사용하자.</li>
  <li>기본키는 Long 타입의 대리키를 사용하자.
    <ul>
      <li>대리키는 비즈니스와 아무 관련이 없기 때문에 비즈니스가 변경되어도 유연한 대처가 가능하다.</li>
      <li>JPA에서는 <code class="language-plaintext highlighter-rouge">@GenerateValue</code>를 통해 간편하게 대리키를 생성할 수 있다.</li>
    </ul>
  </li>
  <li>선택적 비식별 관계보다는 필수적 비식별 관계를 사용하는 것이 좋다.
    <ul>
      <li>선택적인 비식별 관계는 NULL을 허용하므로 조인할  때에 외부 조인을 사용해야 한다.</li>
      <li>반면에 필수적 비식별 관계는 NOT NULL로 항상 관계가 있다는 것을 보장하므로 내부 조인만 사용해도 된다.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

  </div>

</article>

      </div>
    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer"><div class="copyright">
            
            <p>Copyright &copy; 2022 Chloe.</p>
            
          </div>    
        </footer>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js"></script>
    <script type="text/javascript">
      const lightbox = GLightbox({
          touchNavigation: true,
          loop: true,
          autoplayVideos: true
      });
    </script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js" integrity="sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"
            onload="renderMathInElement(document.body,{
                    delimiters: [
                    { left: '$$',  right: '$$',  display: true  },
                    { left: '$',   right: '$',   display: false },
                    { left: '\\[', right: '\\]', display: true  },
                    { left: '\\(', right: '\\)', display: false }
                    ]});">
    </script>
  </body>
</html>
